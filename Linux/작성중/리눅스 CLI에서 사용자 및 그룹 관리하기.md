# 리눅스 CLI에서 사용자 및 그룹 관리하기

*– useradd, userdel, usermod, groupadd, groupdel, groupmod 명령어 가이드 –*

## 📌 문서 개요

이 문서는 리눅스 CLI(터미널) 환경에서 사용자와 그룹을 직접 **추가/삭제/수정**하고,
그룹 구성과 보조 그룹의 개념까지 이해할 수 있도록 설명합니다.

---

## 👤 사용자 계정 관리 명령어

### 1. `useradd` – 사용자 추가

```bash
sudo useradd [옵션] 사용자이름
```

#### 기본 예시

```bash
sudo useradd testuser
```

→ `/etc/passwd`, `/etc/shadow`, `/etc/group`에 자동으로 등록됨
→ **홈 디렉토리**는 자동 생성되지 않기 때문에 `-m` 옵션을 권장

#### 자주 쓰는 옵션

| 옵션             | 설명           |
| -------------- | ------------ |
| `-m`           | 홈 디렉토리 자동 생성 |
| `-s /bin/bash` | 사용할 로그인 셸 지정 |
| `-d /home/폴더명` | 홈 디렉토리 경로 지정 |
| `-g 그룹명`       | 기본 그룹 지정     |
| `-G 그룹1,그룹2`   | 보조 그룹 추가     |
| `-c "설명"`      | 사용자 설명       |

#### 예시 (홈 디렉토리 포함, bash 셸 사용)

```bash
sudo useradd -m -s /bin/bash -c "개발자 계정" devuser
```

---

### 🔎 사용자 생성 시 그룹 지정하지 않으면?

* `useradd testuser`로 그룹을 지정하지 않으면,
* \*\*동일한 이름(testuser)\*\*의 그룹이 자동 생성됩니다.
* 이 그룹이 `/etc/passwd`의 GID로 설정되어 **기본 그룹**이 됩니다.
* `/etc/group`에도 그룹이 생성되지만, 사용자명은 적히지 않습니다.

#### `/etc/passwd` 예시:

```
testuser:x:1001:1001:...:/home/testuser:/bin/bash
```

#### `/etc/group` 예시:

```
testuser:x:1001:
```

→ 이 경우 `testuser`는 `/etc/passwd`의 GID 1001로 `testuser` 그룹에 속하며,
→ 그룹 파일에는 사용자명이 없어도 **기본 그룹으로 작동합니다.**

---

### 2. `passwd` – 비밀번호 설정

```bash
sudo passwd 사용자이름
```

→ 사용자에게 로그인 가능한 암호를 설정합니다.

---

### 3. `userdel` – 사용자 삭제

```bash
sudo userdel [옵션] 사용자이름
```

| 옵션   | 설명                    |
| ---- | --------------------- |
| `-r` | 홈 디렉토리 및 메일 스풀도 함께 삭제 |

#### 예시

```bash
sudo userdel -r testuser
```

---

### 4. `usermod` – 사용자 수정

```bash
sudo usermod [옵션] 사용자이름
```

| 옵션           | 설명                 |
| ------------ | ------------------ |
| `-l 새이름`     | 사용자명 변경            |
| `-d /경로 -m`  | 홈 디렉토리 이동          |
| `-s /셸경로`    | 로그인 셸 변경           |
| `-g 그룹명`     | 기본 그룹 변경           |
| `-G 그룹1,그룹2` | 보조 그룹 설정 (덮어쓰기 주의) |
| `-aG 그룹`     | 보조 그룹 추가 (기존 유지) ✅ |

#### 예시

```bash
sudo usermod -aG docker testuser
```

---

## 👥 그룹 관리 명령어

### 1. `groupadd` – 그룹 생성

```bash
sudo groupadd 그룹명
```

### 2. `groupdel` – 그룹 삭제

```bash
sudo groupdel 그룹명
```

### 3. `groupmod` – 그룹 이름 변경

```bash
sudo groupmod -n 새이름 기존이름
```

---

## ✅ 하나의 그룹에 여러 사용자 추가하기

### 방법 1. `usermod -aG` 사용

```bash
sudo usermod -aG developers user1
sudo usermod -aG developers user2
sudo usermod -aG developers user3
```

### 방법 2. `/etc/group` 직접 수정

```bash
developers:x:1002:user1,user2,user3
```

→ 쉘 재로그인 후 적용되며, `id user1`로 확인 가능

---

## 📌 왜 그룹에 여러 사용자를 넣을까?

* 여러 사용자가 **공용 디렉토리나 파일**을 사용할 수 있게 하려고
* **보안 관리가 쉬움**: 그룹만 관리하면 사용자별 권한 관리 불필요
* **협업이 유리**: 같은 권한을 가진 팀 단위 작업 가능

---

## ❓ 보조 그룹(Supplementary Group)이란?

### ✅ 리눅스에서 사용자 그룹은 두 종류

| 종류                           | 설명                      | 설정 위치         |
| ---------------------------- | ----------------------- | ------------- |
| 기본 그룹 (Primary Group)        | 사용자가 파일을 만들면 이 그룹 소유로 됨 | `/etc/passwd` |
| 보조 그룹 (Supplementary Groups) | 사용자 추가로 소속된 다른 그룹       | `/etc/group`  |

### ✅ 기본 그룹은 자동 지정됨

```bash
testuser:x:1001:1001:...:/home/testuser:/bin/bash
```

→ 위에서 GID=1001이 기본 그룹. 이 정보는 `/etc/group`에 사용자명이 없어도 **기본 그룹으로 인정**됩니다.

### ✅ 보조 그룹은 언제?

사용자를 그룹에 추가하는 순간 보조 그룹이 됩니다:

```bash
developers:x:1002:testuser
```

→ `testuser`는 `developers` 그룹의 **보조 그룹 구성원**

---

## 🎯 보조 그룹이 필요한 이유

| 이유     | 설명                                          |
| ------ | ------------------------------------------- |
| 권한 확대  | 한 사용자가 여러 역할 수행 가능 (ex. docker, git, web 등) |
| 협업 관리  | 디렉토리나 파일을 여러 그룹이 공유 가능                      |
| 분리된 소속 | 기본 그룹은 하나지만, 보조 그룹은 여러 개 가능                 |

---

## 🔍 사용자/그룹 확인 명령어

| 명령어             | 설명                 |
| --------------- | ------------------ |
| `id 사용자명`       | UID, GID, 모든 그룹 확인 |
| `groups 사용자명`   | 해당 사용자의 그룹만 출력     |
| `getent passwd` | 모든 사용자 목록 조회       |
| `getent group`  | 모든 그룹 목록 조회        |

---

## ✅ 전체 요약

| 작업       | 명령어           | 설명                           |
| -------- | ------------- | ---------------------------- |
| 사용자 추가   | `useradd`     | `-m`, `-s`, `-g`, `-G`, `-c` |
| 비밀번호 설정  | `passwd`      | 로그인 가능하게                     |
| 사용자 삭제   | `userdel`     | `-r` 옵션으로 홈 디렉토리까지 삭제        |
| 사용자 수정   | `usermod`     | `-aG`로 보조 그룹 추가              |
| 그룹 생성    | `groupadd`    | 새 그룹 만들기                     |
| 그룹 삭제    | `groupdel`    | 그룹 제거                        |
| 그룹 이름 변경 | `groupmod -n` | 이름 변경                        |

---